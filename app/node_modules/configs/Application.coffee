deps = [
    'umd-core/src/common'
    'umd-core/src/BasicBackboneApplication'
    'umd-core/src/internationalize'
    'umd-core/src/validation/validation'
    'umd-core/src/validation/validators'
    './AppRouter'
    './resources'
    '../components/Toolbar'
]

# When using React, use 'freact' function instead of 'factory' function
# It exposes React and ReactDOM variables
freact = ({ $, i18n }, BasicBackboneApplication, internationalize, validation, validators, AppRouter, resources, Toolbar)->

    class Application extends BasicBackboneApplication
        name: 'application'

        initRouter: (options)->
            @router = new AppRouter { app: @ }
            return

        init: ->
            # multilingual configuration
            @addInitializer internationalize

            # add model validation
            @addInitializer validation
            validators.defaults.translator = i18n

            @addInitializer (options)->
                app = @
                router = @router

                # add translations
                app.updateResources resources

                # append some containers
                $(document.body).append """
                    <div id="toolbar"></div>
                    <div id="content"></div>
                """

                # render Toolbar in #toolbar
                ReactDOM.render `<Toolbar app={ app } />`, document.getElementById('toolbar')

                # tell the router to render content in #content
                router.container = document.getElementById('content')

                return

            return
deps = [
    'umd-core/src/common'
    'umd-core/src/models/BackboneCollection'
    { amd: 'jquery-mockjax' }
]

freact = ({ $ }, BackboneCollection)->
    # https://github.com/jakerella/jquery-mockjax

    ids = 0

    userList = new BackboneCollection [{
        id: ++ids
        firstName: 'Solid'
        lastName: 'SNAKE'
        age: 1
    }, {
        id: ++ids
        firstName: 'Mikasa'
        lastName: 'ACKERMAN'
        age: 3
    }, {
        id: ++ids
        firstName: 'Integra'
        lastName: 'FAIRBOOK WINGATES HELLSING'
        age: 4
    }, {
        id: ++ids
        firstName: 'Wade'
        lastName: 'WILSON'
        age: 2
    }]

    # simulate a response time between 50 and 300 ms
    responseTime = [50, 300]

    url = '/rest/users'
    urlWithIdReg = /^\/rest\/users\/(\d+)$/

    # return list of users when GET /rest/users
    $.mockjax
        url: url
        type: 'GET'
        responseTime: responseTime,
        response: ->
            this.responseText = userList.toJSON()
            return

    # return user when GET /rest/users/id
    $.mockjax
        url: urlWithIdReg
        urlParams: ['id'],
        type: 'GET'
        responseTime: responseTime,
        response: (settings)->
            id = settings.urlParams.id
            this.responseText = userList.get(id)
            return

    # add user when POST /rest/users
    $.mockjax
        url: url
        type: 'POST'
        responseTime: responseTime,
        response: (settings)->
            data = JSON.parse settings.data
            data.id = ++ids
            user = userList.add data, { merge: true }
            this.responseText = user
            return

    # save user when PUT /rest/users/id
    $.mockjax
        url: urlWithIdReg
        urlParams: ['id'],
        type: 'PUT'
        responseTime: responseTime,
        response: (settings)->
            id = settings.urlParams.id
            data = JSON.parse settings.data
            user = userList.get(id)
            data.id = user.id
            for own prop of user.attributes
                delete user.attributes[prop]
            user.set(data)
            this.responseText = user
            return

    # update user when PATCH /rest/users/id
    $.mockjax
        url: urlWithIdReg
        urlParams: ['id'],
        type: 'PATCH'
        responseTime: responseTime,
        response: (settings)->
            id = settings.urlParams.id
            data = JSON.parse settings.data
            user = userList.get(id)
            user.set(data)
            this.responseText = user
            return

    # delete user when DELETE /rest/users/id
    $.mockjax
        url: urlWithIdReg
        urlParams: ['id'],
        type: 'DELETE'
        responseTime: responseTime,
        response: (settings)->
            id = settings.urlParams.id
            user = userList.remove(id)
            this.responseText = user
            return

    return

